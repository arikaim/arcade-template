{% set games = createModel('Games','arcade').getActive() %}
{% set games_per_page = getOption('arcade.games.per.page',50) %}
{% if query is not empty %}
    {% set games = games.join('games_translations', 'game_id', '=', 'games.id', 'left outer') %}
    {% set games = games.whereRaw("(UPPER(games.title) LIKE ?",["%" ~ query|upper ~ "%"]) %}
    {% set games = games.orWhereRaw("UPPER(games.display_name) LIKE ?",["%" ~ query|upper ~ "%"]) %}
    {% set games = games.orWhereRaw("UPPER(games_translations.display_name) LIKE ? )",["%" ~ query|upper ~ "%"]) %}    
    {% set games = games.selectRaw('distinct games.id,games.uuid,games.position,games.slug,games.title,games.description,games.instructions,games.type,games.url,games.thumbnail') %}    
{% else %}
{% set games = games.notPremiumGamesQuery() %}
    {% if mobile == true %}
        {% set games = games.mobileGamesQuery(mobile) %}  
    {% elseif home_page == true %}
        {% set games = games.homePageGamesQuery()%}     
    {% endif %}
    {% set games = games.orderBy("date_created",'desc') %}
{% endif %}

{% if featured == true %}
    {% set max = max|default(20) %}
    {% set games = games.where('featured','=',1).take(max) %}   
{% endif %}
{% if popular == true %}
    {% set max = max|default(20) %}
    {% set games = games.orderBy('plays','desc').take(max) %}   
{% endif %}

{% set items = paginate(games,'games.home',games_per_page) %}
{% set items = items.getItems()%}
{% for game in items %}
    {% set thumbnail = (game.thumbnail is not empty) ? game.thumbnail : template_url ~ '/images/gamepad.svg' %}
    <div class="rounded game-card text-center">     
        <a href="{{ game.getGamePageUrl() }}">                                         
            <img class="w-32 h-32 game-image rounded" src="{{ thumbnail }}">                  
        </a>    
        <div class="pb-2">
            {{ game.display_title|sliceText(20)}}
        </div>
    </div>    
{% endfor %}
{% if items is empty and query is not empty %}
<div class="mt-2 pl-4">
    <h5>{{ labels.not_found }}</h5>
</div>
{% endif %}