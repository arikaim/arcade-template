{% set games = createModel('Games','arcade').getActive() %}

{% if query is not empty %}
    {% set games = games.join('games_translations', 'game_id', '=', 'games.id', 'left outer') %}
    {% set games = games.whereRaw("(UPPER(games.title) LIKE ?",["%" ~ query|upper ~ "%"]) %}
    {% set games = games.orWhereRaw("UPPER(games.display_name) LIKE ?",["%" ~ query|upper ~ "%"]) %}
    {% set games = games.orWhereRaw("UPPER(games_translations.display_name) LIKE ? )",["%" ~ query|upper ~ "%"]) %}    
    {% set games = games.selectRaw('distinct games.id,games.uuid,games.position,games.slug,games.title,games.description,games.instructions,games.type,games.url,games.thumbnail') %}    
{% else %}
    {% if mobile == true %}
        {% set games = games.mobileGamesQuery(mobile) %}  
    {% endif %}
    {% set games = games.orderBy("date_created",'desc') %}
{% endif %}
{% set games_per_page = getOption('arcade.games.per.page',50) %}
{% if featured == true %}
    {% set max = max|default(20) %}
    {% set games = games.where('featured','=',1).take(max) %}   
{% endif %}
{% if popular == true %}
    {% set max = max|default(20) %}
    {% set games = games.orderBy('plays','desc').take(max) %}   
{% endif %}

{% set items = paginate(games,'games.home',games_per_page) %}
{% set items = items.getItems()%}
{% for game in items %}
    {% set thumbnail = (game.thumbnail is not empty) ? game.thumbnail : template_url ~ '/images/gamepad.svg' %}
    <div class="ui raised card fluid borderless rounded game-card">     
        <a class="w-full h-full show-popup" href="{{ game.getGamePageUrl() }}" >                                         
            <img class="w-full h-full game-image rounded" data-src="{{ game.thumbnail }}">                  
        </a>     
        <div class="ui popup top left transition inverted hidden">
            <div class="p-0 text-white">
                {{ game.display_title }}
            </div>
        </div>
    </div>    
{% endfor %}
{% if items is empty and query is not empty %}
<div class="mt-2 pl-4">
    <h5>{{ labels.not_found }}</h5>
</div>
{% endif %}