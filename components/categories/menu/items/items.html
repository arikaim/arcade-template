{% set language = language|default(current_language) %}
{% set parent_id = parent_id|default(null) %}
{% set max_items = max_items|default(null) %}
{% set image_class = image_class|default('mini circular mr-2') %}

{% set model = createModel('Category','category').getActive().where('parent_id','=',parent_id) %}
{% if branch is not empty %}
    {% set model = model.where('branch','=',branch) %}
{% endif %}
{% set items = model.orderBy('position','asc').orderBy('id','asc').get()  %}

{% if max_items is empty %}
    {% set max_items = items.count()  %}
{% endif %}
{% set page_url = page_url|default('{{ slug }}') %}
{% set index = 1 %}

{% for item in items %} 
    {%- if index <= max_items %}
        {%- set url = page_url|renderText({ slug: item.getSlug(language) }) -%}
        <div class="item {{ item_class }}">  
            {% if item.thumbnail is not empty %}
            <img class="ui image {{ image_class }}" src="{{ item.getImageUrl() }}">
            {% endif %}                
            <a href="{{ url(url,true,language) }}">        
                <span class="{{ item_text_class }}">{{ item.getTitle(null,language)|string }}</span>
            </a>                                           
        </div>
        {%- set index = index + 1 -%}
    {% endif %}
{% endfor %}    